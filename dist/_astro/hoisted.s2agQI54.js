import{c as L}from"./wrapper.DVMbrJAx.js";import"./hoisted.BkoFJ0Lt.js";const j="https://ooevpxkcftpemofjantd.supabase.co",k="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vZXZweGtjZnRwZW1vZmphbnRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3Njg3ODYsImV4cCI6MjA4MTM0NDc4Nn0.rbUanSpOKtwqcSs71eCLw_K2ywpuWSfG9Ae88hBmu6M",o=L(j,k),c=document.getElementById("loading-state"),I=document.getElementById("not-logged-state"),_=document.getElementById("profile-content");let i=null,u=null;async function M(){const{data:{user:t}}=await o.auth.getUser();if(!t){c?.classList.add("hidden"),I?.classList.remove("hidden");return}i=t,await w()}async function w(){try{const{data:t}=await o.from("users").select("*").eq("id",i.id).single();u=t;const{data:n}=await o.from("stories").select("*").eq("author_id",i.id).order("created_at",{ascending:!1}),{count:l}=await o.from("follows").select("*",{count:"exact",head:!0}).eq("following_id",i.id),{count:s}=await o.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",i.id),x=(n||[]).reduce((e,C)=>e+(C.views||0),0),r=(n||[]).map(e=>e.id),{count:y}=r.length>0?await o.from("likes").select("*",{count:"exact",head:!0}).in("story_id",r):{count:0},{count:B}=r.length>0?await o.from("comments").select("*",{count:"exact",head:!0}).in("story_id",r):{count:0},m=t?.username||i.email?.split("@")[0]||"Utilisateur",g=document.getElementById("user-avatar"),f=document.getElementById("user-name"),p=document.getElementById("user-bio"),h=document.getElementById("user-badges");g&&(g.textContent=m.charAt(0).toUpperCase()),f&&(f.textContent=m),p&&(p.textContent=t?.bio_geek||'Aucune bio dÃ©finie. Cliquez sur "Modifier le profil" pour en ajouter une.'),h&&t?.badges&&t.badges.length>0&&(h.innerHTML=t.badges.map(e=>`<span class="px-3 py-1 bg-gold-old/20 text-gold-old text-sm rounded-full">${e}</span>`).join(""));const d=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString();document.getElementById("stat-followers").textContent=d(l||0),document.getElementById("stat-following").textContent=d(s||0),document.getElementById("stat-stories-count").textContent=(n?.length||0).toString(),document.getElementById("stat-views").textContent=d(x),document.getElementById("stat-likes").textContent=d(y||0),document.getElementById("stat-comments").textContent=d(B||0),document.getElementById("stat-publications").textContent=(n?.length||0).toString();const v=document.getElementById("stories-grid");v&&n&&n.length>0&&(v.innerHTML=n.map(e=>`
          <a href="/stories/${e.slug}" class="parchment-card rounded-lg overflow-hidden group hover:border-gold-old/50 transition-all">
            <div class="aspect-[3/4] bg-dark-purple overflow-hidden">
              ${e.cover_url?`<img src="${e.cover_url}" alt="${e.title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">`:'<div class="w-full h-full flex items-center justify-center text-6xl">ğŸ“–</div>'}
            </div>
            <div class="p-4">
              <span class="px-2 py-1 bg-gold-old/20 text-gold-old text-xs rounded mb-2 inline-block">${e.type}</span>
              <h3 class="text-parchment-light font-medium group-hover:text-gold-old transition-colors line-clamp-2">${e.title}</h3>
              <div class="flex items-center gap-3 mt-2 text-sm text-parchment/60">
                <span>ğŸ‘ï¸ ${d(e.views||0)}</span>
                <span>${e.status==="published"?"âœ…":"ğŸ“"}</span>
              </div>
            </div>
          </a>
        `).join("")),c?.classList.add("hidden"),_?.classList.remove("hidden")}catch(t){console.error("Error loading profile:",t),c?.classList.add("hidden"),I?.classList.remove("hidden")}}const S=document.getElementById("edit-profile-btn"),a=document.getElementById("edit-modal"),U=document.getElementById("close-modal-btn"),$=document.getElementById("cancel-edit-btn"),q=document.getElementById("edit-profile-form"),E=document.getElementById("edit-username"),b=document.getElementById("edit-bio");S?.addEventListener("click",()=>{E.value=u?.username||"",b.value=u?.bio_geek||"",a?.classList.remove("hidden")});U?.addEventListener("click",()=>a?.classList.add("hidden"));$?.addEventListener("click",()=>a?.classList.add("hidden"));q?.addEventListener("submit",async t=>{t.preventDefault();const n=E.value.trim(),l=b.value.trim();if(!n){alert("Le nom d'utilisateur est requis.");return}try{const{error:s}=await o.from("users").update({username:n,bio_geek:l}).eq("id",i.id);if(s){console.error("Error updating profile:",s),alert("Erreur lors de la mise Ã  jour: "+s.message);return}alert("Profil mis Ã  jour avec succÃ¨s !"),a?.classList.add("hidden"),await w()}catch(s){console.error("Error:",s),alert("Erreur lors de la mise Ã  jour du profil.")}});M();
