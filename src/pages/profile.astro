---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import StoryCard from '../components/StoryCard.astro';

// Simulation de donn√©es - √† remplacer par Supabase Auth
const user = {
  id: '1',
  username: 'DarkScribe',
  email: 'darkscribe@example.com',
  avatar_url: null,
  bio_geek: 'Auteur passionn√© de dark fantasy depuis 10 ans. Fan de WoW, Dark Souls et tout ce qui touche √† la magie noire. üåë‚öîÔ∏è',
  badges: ['Auteur V√©rifi√©', 'Top 10 Mensuel', 'Pioneer'],
  followers: 5200,
  following: 128,
  created_at: '2023-06-15'
};

const userStories = [
  {
    id: '1',
    title: 'Les Chroniques du Cr√©puscule √âternel',
    slug: 'chroniques-crepuscule-eternel',
    author: user.username,
    coverUrl: 'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=400&h=600&fit=crop',
    genre: 'Dark Fantasy',
    tags: ['magie', 'dragons'],
    type: 'novel' as const,
    views: 45230,
    rating: 4.8
  },
  {
    id: '2',
    title: 'L\'Ombre du N√©ant',
    slug: 'ombre-du-neant',
    author: user.username,
    coverUrl: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400&h=600&fit=crop',
    genre: 'Dark Fantasy',
    tags: ['horreur', 'myst√®re'],
    type: 'novel' as const,
    views: 18500,
    rating: 4.5
  },
];

const stats = {
  totalViews: 125000,
  totalLikes: 8900,
  totalComments: 1250,
  storiesCount: 12
};

const formatNumber = (num: number) => {
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num.toString();
};
---

<BaseLayout title={`Profil de ${user.username}`}>
  <Navbar />
  
  <main class="pt-24 pb-20 px-4">
    <div class="max-w-6xl mx-auto">
      <!-- Profile Header -->
      <section class="parchment-card rounded-2xl p-8 mb-8">
        <div class="flex flex-col md:flex-row items-start gap-8">
          <!-- Avatar -->
          <div class="flex-shrink-0">
            <div class="w-32 h-32 rounded-full bg-dark-purple flex items-center justify-center text-5xl text-gold-old font-gothic shadow-glow">
              {user.username.charAt(0)}
            </div>
          </div>
          
          <!-- Info -->
          <div class="flex-1">
            <div class="flex flex-wrap items-center gap-4 mb-4">
              <h1 class="gothic-title text-3xl">{user.username}</h1>
              {user.badges.map(badge => (
                <span class="px-3 py-1 bg-gold-old/20 text-gold-old text-sm rounded-full">
                  {badge}
                </span>
              ))}
            </div>
            
            <p class="text-parchment/80 mb-6 max-w-2xl">{user.bio_geek}</p>
            
            <div class="flex flex-wrap gap-6 mb-6">
              <div class="text-center">
                <div class="text-2xl font-gothic text-gold-old">{formatNumber(user.followers)}</div>
                <div class="text-sm text-parchment/60">Abonn√©s</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-gothic text-gold-old">{formatNumber(user.following)}</div>
                <div class="text-sm text-parchment/60">Abonnements</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-gothic text-gold-old">{stats.storiesCount}</div>
                <div class="text-sm text-parchment/60">Histoires</div>
              </div>
            </div>
            
            <div class="flex gap-4">
              <a href="/profile/edit" class="glow-button px-6 py-2">
                Modifier le profil
              </a>
              <a href="/write" class="px-6 py-2 border border-gold-old/50 text-gold-old rounded hover:bg-gold-old/10 transition-colors">
                Nouvelle histoire
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Stats -->
      <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="parchment-card p-6 rounded-xl text-center">
          <div class="text-3xl font-gothic text-gold-old mb-1">{formatNumber(stats.totalViews)}</div>
          <div class="text-sm text-parchment/60">Vues totales</div>
        </div>
        <div class="parchment-card p-6 rounded-xl text-center">
          <div class="text-3xl font-gothic text-gold-old mb-1">{formatNumber(stats.totalLikes)}</div>
          <div class="text-sm text-parchment/60">Likes</div>
        </div>
        <div class="parchment-card p-6 rounded-xl text-center">
          <div class="text-3xl font-gothic text-gold-old mb-1">{formatNumber(stats.totalComments)}</div>
          <div class="text-sm text-parchment/60">Commentaires</div>
        </div>
        <div class="parchment-card p-6 rounded-xl text-center">
          <div class="text-3xl font-gothic text-gold-old mb-1">{stats.storiesCount}</div>
          <div class="text-sm text-parchment/60">Publications</div>
        </div>
      </section>

      <!-- User Stories -->
      <section>
        <div class="flex items-center justify-between mb-6">
          <h2 class="gothic-title text-2xl">Mes Histoires</h2>
          <a href="/write" class="text-gold-old hover:text-gold-bright transition-colors flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Nouvelle histoire
          </a>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          {userStories.map(story => (
            <StoryCard {...story} />
          ))}
        </div>
      </section>
    </div>
  </main>
  
  <Footer />
</BaseLayout>
