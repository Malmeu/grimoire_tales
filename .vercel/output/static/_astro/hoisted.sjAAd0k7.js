import{c as y}from"./wrapper.DVMbrJAx.js";import"./hoisted.BkoFJ0Lt.js";const v="https://ooevpxkcftpemofjantd.supabase.co",I="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vZXZweGtjZnRwZW1vZmphbnRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3Njg3ODYsImV4cCI6MjA4MTM0NDc4Nn0.rbUanSpOKtwqcSs71eCLw_K2ywpuWSfG9Ae88hBmu6M",g=y(v,I),i=document.getElementById("chapter-form"),n=i?.querySelector('button[type="submit"]'),f=i?.dataset.storyId,w=i?.dataset.storySlug,s=i?.dataset.storyType,u=parseInt(i?.dataset.nextNumber||"1");let d=[];const r=document.getElementById("pages-dropzone"),l=document.getElementById("pages-input"),p=document.getElementById("pages-preview");r&&l&&(r.addEventListener("click",()=>l.click()),l.addEventListener("change",()=>{l.files&&h(Array.from(l.files))}),r.addEventListener("dragover",t=>{t.preventDefault(),r.classList.add("border-gold-old")}),r.addEventListener("dragleave",()=>{r.classList.remove("border-gold-old")}),r.addEventListener("drop",t=>{t.preventDefault(),r.classList.remove("border-gold-old");const e=t.dataTransfer?.files;e&&h(Array.from(e))}));function h(t){t.forEach(e=>{if(!e.type.startsWith("image/"))return;const a=new FileReader;a.onload=m=>{const c=m.target?.result;d.push(c),b()},a.readAsDataURL(e)})}function b(){p&&(p.innerHTML=d.map((t,e)=>`
      <div class="relative group">
        <img src="${t}" alt="Page ${e+1}" class="w-full h-32 object-cover rounded" />
        <button type="button" data-idx="${e}" class="remove-page absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity">×</button>
        <span class="absolute bottom-1 left-1 text-xs bg-black/50 text-white px-1 rounded">${e+1}</span>
      </div>
    `).join(""),p.querySelectorAll(".remove-page").forEach(t=>{t.addEventListener("click",e=>{const a=parseInt(e.target.dataset.idx||"0");d.splice(a,1),b()})}))}i?.addEventListener("submit",async t=>{t.preventDefault();const{data:{user:e}}=await g.auth.getUser();if(!e){alert("Vous devez être connecté pour ajouter un chapitre."),window.location.href="/login";return}const a=document.getElementById("chapter-title").value.trim(),c=document.getElementById("editor-textarea")?.value.trim()||"";if(!a){alert("Veuillez entrer un titre pour le chapitre.");return}if(s!=="comic"&&!c){alert("Veuillez écrire le contenu du chapitre.");return}if(s==="comic"&&d.length===0){alert("Veuillez ajouter au moins une page pour ce chapitre de BD.");return}n&&(n.disabled=!0,n.textContent="Publication en cours...");try{const{error:o}=await g.from("chapters").insert({story_id:f,title:a,chapter_number:u,content:s!=="comic"?c:null,word_count:s!=="comic"?c.split(/\s+/).filter(Boolean).length:0,images:s==="comic"?d:[]});if(o)throw console.error("Erreur création chapitre:",o),new Error(o.message);alert("Chapitre publié avec succès !"),s==="comic"?window.location.href=`/bd/${f}/chapter/${u}`:window.location.href=`/stories/${w}/chapter/${u}`}catch(o){console.error("Erreur:",o),alert("Erreur lors de la publication: "+(o.message||"Erreur inconnue"))}finally{n&&(n.disabled=!1,n.textContent="Publier le chapitre")}});
